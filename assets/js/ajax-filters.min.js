jQuery(document).ready(function(a){function b(b,c){if($supports_html5_history){var f=b.find(".job_filters"),g=a(f).serialize(),h=a("div.job_listings").index(b),i=f.find("#search_keywords").val()?"search_keywords="+encodeURIComponent(f.find("#search_keywords").val()):"",j=f.find("#search_location").val()?"search_location="+encodeURIComponent(f.find("#search_location").val()):"",k="current_page="+c,l=d+(i||j||k?"?":"")+i+(i&&j?"&":"")+j+((i||j)&&k?"&":"")+k,m=function(){for(var a=[],b=0;b<e.length;b++)value=decodeURIComponent(e[b].split("=")[1]),pl=/\+/g,value=value.replace(pl," "),a.push(value);return a}(),n=!1;a:for(var o=0;o<m.length;o++)if(""===m[o]){n=!0;break a}if(n)window.history.replaceState({id:"job_manager_state",page:c,data:g,index:h},"",l),console.log("empty");else{if(document.location.href===l)return void console.log("The current search was the same as the last");window.history.pushState({id:"job_manager_state",page:c,data:g,index:h},"",l),console.log("different")}}}var c=[];a(".job_listings").on("update_results",function(d,e,f,g){console.log("update_results starting");var h="",i=a(this),j=i.find(".job_filters"),k=i.find(".showing_jobs"),l=i.find(".job_listings"),m=i.data("per_page"),n=i.data("orderby"),o=i.data("order"),p=i.data("featured"),q=i.data("filled"),r=a("div.job_listings").index(this);if(!(0>r)){if(c[r]&&c[r].abort(),b(i.closest("div.job_listings"),e,!1),f||(a(l).addClass("loading"),a("li.job_listing, li.no_job_listings_found",l).css("visibility","hidden"),e>1&&1!=i.data("show_pagination")?a(l).before('<a class="load_more_jobs load_previous" href="#"><strong>'+job_manager_ajax_filters.i18n_load_prev_listings+"</strong></a>"):i.find(".load_previous").remove(),i.find(".load_more_jobs").data("page",e)),1==i.data("show_filters")){var s=[];a(':input[name="filter_job_type[]"]:checked, :input[name="filter_job_type[]"][type="hidden"], :input[name="filter_job_type"]',j).each(function(){s.push(a(this).val())});var t=j.find(':input[name^="search_categories"]').map(function(){return a(this).val()}).get(),u="",v="",w=j.find(':input[name="search_keywords"]'),x=j.find(':input[name="search_location"]');w.val()!==w.attr("placeholder")&&(u=w.val()),x.val()!==x.attr("placeholder")&&(v=x.val()),h={lang:job_manager_ajax_filters.lang,search_keywords:u,search_location:v,search_categories:t,filter_job_type:s,per_page:m,orderby:n,order:o,page:e,featured:p,filled:q,show_pagination:i.data("show_pagination"),form_data:j.serialize()}}else{var t=i.data("categories"),u=i.data("keywords"),v=i.data("location");t&&(t=t.split(",")),h={lang:job_manager_ajax_filters.lang,search_categories:t,search_keywords:u,search_location:v,per_page:m,orderby:n,order:o,page:e,featured:p,filled:q,show_pagination:i.data("show_pagination")}}c[r]=a.ajax({type:"POST",url:job_manager_ajax_filters.ajax_url.toString().replace("%%endpoint%%","get_listings"),data:h,success:function(b){if(b)try{b.showing?a(k).show().html("<span>"+b.showing+"</span>"+b.showing_links):a(k).hide(),b.showing_all?a(k).addClass("wp-job-manager-showing-all"):a(k).removeClass("wp-job-manager-showing-all"),b.html&&(f&&g?a(l).prepend(b.html):f?a(l).append(b.html):a(l).html(b.html)),1==i.data("show_pagination")?(i.find(".job-manager-pagination").remove(),b.pagination&&i.append(b.pagination)):(!b.found_jobs||b.max_num_pages<=e?a(".load_more_jobs:not(.load_previous)",i).hide():g||a(".load_more_jobs",i).show(),a(".load_more_jobs",i).removeClass("loading"),a("li.job_listing",l).css("visibility","visible")),a(l).removeClass("loading"),i.triggerHandler("updated_results",b)}catch(c){window.console&&console.log(c)}},error:function(a,b,c){window.console&&"abort"!==b&&console.log(b+": "+c)},statusCode:{404:function(){window.console&&console.log("Error 404: Ajax Endpoint cannot be reached. Go to Settings > Permalinks and save to resolve.")}}}),console.log("update_results ending")}}),a("#search_keywords, #search_location, .job_types :input, #search_categories, .job-manager-filter").change(function(){var b=a(this).closest("div.job_listings");b.triggerHandler("update_results",[1,!1])}).on("keyup",function(b){13===b.which&&a(this).trigger("change")}),a(".job_filters").on("click",".reset",function(){console.log("job_filters click");var b=a(this).closest("div.job_listings"),c=a(this).closest("form");return c.find(':input[name="search_keywords"], :input[name="search_location"], .job-manager-filter').not(':input[type="hidden"]').val("").trigger("chosen:updated"),c.find(':input[name^="search_categories"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),a(':input[name="filter_job_type[]"]',c).not(':input[type="hidden"]').attr("checked","checked"),b.triggerHandler("reset"),b.triggerHandler("update_results",[1,!1]),!1}),a(document.body).on("click",".load_more_jobs",function(){var b=a(this).closest("div.job_listings"),c=parseInt(a(this).data("page")||1),d=!1;return a(this).addClass("loading"),a(this).is(".load_previous")?(c-=1,d=!0,1===c?a(this).remove():a(this).data("page",c)):(c+=1,a(this).data("page",c)),b.triggerHandler("update_results",[c,!0,d]),!1}),a("div.job_listings").on("click",".job-manager-pagination a",function(){var b=a(this).closest("div.job_listings"),c=a(this).data("page");return b.triggerHandler("update_results",[c,!1]),a("body, html").animate({scrollTop:b.offset().top},600),!1}),a.isFunction(a.fn.chosen)&&(1==job_manager_ajax_filters.is_rtl&&a('select[name^="search_categories"]').addClass("chosen-rtl"),a('select[name^="search_categories"]').chosen({search_contains:!0})),window.history&&window.history.pushState?$supports_html5_history=!0:$supports_html5_history=!1;var d=document.location.href.split("?")[0],e=document.location.href.split("?")[1];e=e.split("&"),$supports_html5_history&&a(window).on("onpopstate",function(b){console.log("back"),a(".job_filters").each(function(){var b=a(this).closest("div.job_listings");b.triggerHandler("update_results",[1,!1])})}),a(window).on("load",function(b){a(".job_filters").each(function(){var b=a(this).closest("div.job_listings"),c=b.find(".job_filters"),d=1,e=a("div.job_listings").index(b);if(window.history.state&&window.location.hash){var f=window.history.state;f.id&&"job_manager_state"===f.id&&e==f.index&&(d=f.page,c.deserialize(f.data),c.find(':input[name^="search_categories"]').not(':input[type="hidden"]').trigger("chosen:updated"))}b.triggerHandler("update_results",[d,!1])})})});